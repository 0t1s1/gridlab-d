// Voltage source inverter	
object inverter {
	parent 150;
	name VSI;
	inverter_type FOUR_QUADRANT;
	use_multipoint_efficiency FALSE;
	four_quadrant_control_mode VOLTAGE_SOURCE;
	generator_status ONLINE;
	inverter_efficiency 1;	
	enable_ramp_rates_real true;
	max_ramp_down_real 25.0 MW/s;
	max_ramp_up_real 35.0 MW/s;
	enable_ramp_rates_reactive false;
	max_ramp_down_reactive 100 MVAr/s;
	max_ramp_up_reactive 100 MVAr/s;

	rated_power 10000 kVA; // Per phase rating
	VSI_Rfilter 0.25;
	VSI_Xfilter 1;
	P_Out 9000000;
	Q_Out 3000000;
	V_In 5000+0j;
	I_In 2000+0j;

	flags DELTAMODE;
	dynamic_model_mode PI;
	inverter_convergence_criterion 0.001;
	
	ki_Vterminal 0.01;
	kp_Vterminal 0.1;
	
	// object recorder {
		// property V_In,I_In,VA_In, Pref, Qref, VA_Out, VA_Out.real, VA_Out.imag;
		 // file VSI_inv.csv;
		 // flags DELTAMODE;
		 // interval 1;
	// };
};

object battery {
	name battery_1;
	parent VSI;
	use_internal_battery_model true;
	battery_type LI_ION;
	battery_capacity 500 kWh;
	base_efficiency 1;
	state_of_charge 1; // 1
	generator_mode SUPPLY_DRIVEN;
	
	flags DELTAMODE;
	
	// object recorder {
		// file "battery_pq_soc.csv";
		// property state_of_charge;
		// flags DELTAMODE;
		// interval 1;
		// };
		
	// object recorder {
		// file "battery_pq_status.csv";
		// property battery_state;
		// flags DELTAMODE;
		// interval 1;
	// };

}

object inverter {
	parent 56;
	name VSI_droop;
	inverter_type FOUR_QUADRANT;
	use_multipoint_efficiency FALSE;
	four_quadrant_control_mode VOLTAGE_SOURCE;
	VSI_mode VSI_DROOP;
	generator_status ONLINE;
	inverter_efficiency 1;	
	enable_ramp_rates_real true;
	max_ramp_down_real 15.0 MW/s;
	max_ramp_up_real 15.0 MW/s;
	enable_ramp_rates_reactive false;
	max_ramp_down_reactive 100 MVAr/s;
	max_ramp_up_reactive 100 MVAr/s;

	rated_power 1000 kVA; // Per phase rating
	P_Out 1000000;
	Q_Out 1000000;
	V_In 1000+0j;
	I_In 1000+0j;

	flags DELTAMODE;
	dynamic_model_mode PI;
	inverter_convergence_criterion 10;

	VSI_Rfilter 0.25;
	VSI_Xfilter 1;

	// Droop curve parameters
	Tp_delay 0.001;
	R_fp 0.00000001;
	Tq_delay 0.001;
	R_vq 0.0000005;
	
	// object recorder {
		// property V_In,I_In,VA_In, Pref, Qref, VA_Out, VA_Out.real, VA_Out.imag, VSI_freq;
		 // file VSI_droop.csv;
		 // flags DELTAMODE;
		 // interval 1;
	// };
	
	object complex_assert {
		flags DELTAMODE;
		target VA_Out;
		object player {
			flags DELTAMODE;
			property value;
			file "../VSI_isochronous_droop_VA.csv";
		};
		within "0.1";
	};
}

object battery {
	name battery_2;
	parent VSI_droop;
	use_internal_battery_model true;
	battery_type LI_ION;
	battery_capacity 500 kWh;
	base_efficiency 1;
	state_of_charge 1; // 1
	generator_mode SUPPLY_DRIVEN;
	
	flags DELTAMODE;
	
	// object recorder {
		// file "battery_pq_soc2.csv";
		// property state_of_charge;
		// flags DELTAMODE;
		// interval 1;
		// };
		
	// object recorder {
		// file "battery_pq_status2.csv";
		// property battery_state;
		// flags DELTAMODE;
		// interval 1;
	// };

}

